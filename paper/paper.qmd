---
title: " Total Team Spending and Profitability Results in a Higher League Ranking in the English Premier League"
subtitle: "An Analysis of Economic Predictors on League Rank in the 2023-2024 Season"
author: 
  - Isabella MacLean
thanks: "Code and data are available at: https://github.com/Bellamaclean7/English_Premier_League_Economic
_Predictors_on_League_Rank_2023-2024_Season.git."
date: today
date-format: long
abstract: "This project investigates how to formulate a linear regression model based on three explanatory variables: match attendance, total payroll, and market value, in order to try and predict a teams finishing place in the standings. Utilizing R's lm function, this paper analyzes the relationship between these variables and teams total points accumulated during the English Premier League 2023-2024 season. Findings suggest that each explanatory variable significantly influences a team's league position (total points), highlighting the association between team success and team wealth."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(dplyr)
library(corrplot)
library(dplyr)
library(knitr)
library(readr)
library(here)
library(kableExtra)
library(scales)

analysis_data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))
show_col_types = FALSE

matchday_attendance <- read_csv(here::here("data/raw_data/average_home_matchday_attendance_2023-2024.csv"))
show_col_types = FALSE

market_value <- read_csv(here::here("data/raw_data/market_value_2023-2024.csv"))
show_col_types = FALSE

team_rank <- read_csv(here::here("data/raw_data/team_rank_2023-2024.csv"))
show_col_types = FALSE

total_payroll <- read_csv(here::here("data/raw_data/total_payroll_2023-2024.csv"))
show_col_types = FALSE

total_transfer_spending <- read_csv(here::here("data/raw_data/total_transfer_spending_2023-2024.csv"))
show_col_types = FALSE
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....

# Data {#sec-data}

The analysis dataset used for this paper is comprised of five datasets that were compiled during the data cleaning process. The first dataset, @tbl-1, contains every teams average home matchday attendance for the 2023-2024 season, which was collected from @footballwebpages2023premierleague. The second dataset, @tbl-2, contains every teams current market value, which was collected from @transfermarkt2023premierleague. The third dataset, @tbl-3, contains the current total payroll for each team in the English Premier League, and was collected from @spotrac2023eplpayroll. The forth dataset, @tbl-4, contains the total amount spent in transfer fees prior to the start of the 2023-2024 season for each team in the English Premier League, and was collected from @spotrac2023epltransferfees. The final dataset, @tbl-5, contains the total points earned by each team in the English Premier League during the 2023-2024 as of Matchday 30, and was retrieved from @transfermarkt2023premierleaguematchday30.

```{r}
#| label: tbl-1
#| tbl-cap: The dataset containing average home matchday attendance for each team in the English Premier League during the 2023-2024 season.
#| echo: false
#| warning: false

# Assigning new column names to the dataframe
colnames(matchday_attendance) <- c("Team", "Home Matchday Attendance")

# Ensure that the "Home Matchday Attendance" column is numeric for formatting
matchday_attendance$`Home Matchday Attendance` <- as.numeric(matchday_attendance$`Home Matchday Attendance`)

# Format the "Home Matchday Attendance" column to include commas
matchday_attendance$`Home Matchday Attendance` <- comma(matchday_attendance$`Home Matchday Attendance`)

# Generate the table with adjusted font size to fit the page
kable(matchday_attendance, booktabs = TRUE, align = c("l", rep("r", 6)), "latex", longtable = TRUE) |>
  kable_styling(latex_options = c("striped", "HOLD_position"), font_size = 8)
```

```{r, results='asis'}
#| label: tbl-2
#| tbl-cap: The dataset containing the current market value of each team in the English Premier League.
#| echo: false
#| warning: false

# Assigning new column names to the dataframe
colnames(market_value) <- c("Team", "Market Value")

# Function to format values in billions and millions
format_value <- function(value) {
  if (value >= 1) {
    # Value is in billions
    return(paste0("£", formatC(value, format = "f", digits = 2), "B"))
  } else {
    # Value is in millions
    # Convert to millions (e.g., 0.9 becomes 900)
    million_value <- value * 1000
    return(paste0("£", round(million_value), "M"))
  }
}

# Apply the function to every market value
market_value$`Market Value` <- sapply(market_value$`Market Value`, format_value)

# Generate the table with adjusted font size to fit the page
kable(market_value, booktabs = TRUE, align = c("l", rep("r", 6)), "latex", longtable = TRUE) |>
  kable_styling(latex_options = c("striped", "HOLD_position"), font_size = 8)
```

```{r}
#| label: tbl-3
#| tbl-cap: The dataset containing the current total payroll for each team in the English Premier League.
#| echo: false
#| warning: false

# Assigning new column names to the dataframe
colnames(total_payroll) <- c("Team", "Active Players", "Forwards", "Midfielders", "Defensmen", "Goalkeepers", "Total")

# Generate the table with adjusted font size to fit the page
kable(total_payroll, booktabs = TRUE, align = c("l", rep("r", 6)), "latex", longtable = TRUE) |>
  kable_styling(latex_options = c("striped", "HOLD_position"), font_size = 8)
```

```{r}
#| label: tbl-4
#| tbl-cap: The dataset containing the total amount spent in transfer fees prior to the start of the 2023-2024 season for each team in the English Premier League.
#| echo: false
#| warning: false

# Assigning new column names to the dataframe
colnames(total_transfer_spending) <- c("Team", "Total Transfer Fees")
                             
# Generate the table with adjusted font size to fit the page
kable(total_transfer_spending, booktabs = TRUE, align = c("l", rep("r", 6)), "latex", longtable = TRUE) |>
  kable_styling(latex_options = c("striped", "HOLD_position"), font_size = 8)
```

```{r}
#| label: tbl-5
#| tbl-cap: The dataset containing the total points earned by each team in the English Premier League during the 2023-2024 as of Matchday 30.
#| echo: false
#| warning: false

# Assigning new column names to the dataframe
colnames(team_rank) <- c("Team", "Points")
                             
# Generate the table with adjusted font size to fit the page
kable(team_rank, booktabs = TRUE, align = c("l", rep("r", 6)), "latex", longtable = TRUE) |>
  kable_styling(latex_options = c("striped", "HOLD_position"), font_size = 8)
```

The datasets were then combined during the cleaning process to create one master dataset for analysis. The merging process was conducted on the common column `team`, ensuring that data from each dataset corresponding to a specific team was consolidated into a single row within the analysis dataset. This methodology allowed for a unified view of each team's `matchday attendance`, `market value`, `total team points`, `total payroll`, and `total transfer spending`, facilitating a multifaceted analysis of team performance and financial metrics.

As part of the data cleaning process, specific columns containing numeric values but stored as character strings—due to the inclusion of commas as thousands separators and currency symbols—were converted to their appropriate numeric data types. This conversion involved stripping the character columns 'average_home_matchday_attendance', 'total_wage_bill', and 'transfer_fees' of non-numeric characters (i.e., commas and the pound sterling symbol) and then casting them to integer or numeric types as contextually appropriate. This step was essential for enabling quantitative analysis of these variables.

Furthermore, to streamline the dataset and focus the analysis on key variables of interest, certain columns deemed extraneous to the core analytical objectives were removed. These included detailed payroll information per position (`forwards`, `midfielders`, `defensmen`, `goalkeepers`) and the column `active.players`. The removal of these columns served to reduce the dataset's complexity, facilitating a more focused and manageable analysis of the relationships between team performance metrics and financial expenditures.

The resulting dataset for analysis is shown in @tab-6.

```{r}
#| label: tbl-6
#| tbl-cap: The dataset containing the total points earned by each team in the English Premier League during the 2023-2024 as of Matchday 30.
#| echo: false
#| warning: false

# Assigning new column names to the dataframe
colnames(analysis_data) <- c("Team", "Home Matchday Attendance", "Market Value", "Points", "Total Payroll", "Total Transfer Fees")
                             
# Generate the table with adjusted font size to fit the page
kable(analysis_data, booktabs = TRUE, align = c("l", rep("r", 6)), "latex", longtable = TRUE) |>
  kable_styling(latex_options = c("striped", "HOLD_position"), font_size = 8)
```

# Model

## Linear Regression

A linear regression model is a statistical model for linear relationships between variables given by

$$
Y_i = \beta_0 + \beta_1 X_{i,1} + \beta_2 X_{i,2} + \ldots + \beta_p X_{i,p} + \varepsilon_i \quad \text{for } i = 1, \ldots, n. \tag{1}
$$

As shown in equation (1) a linear regression model has the following components:

- $Y_i$: The dependent variable for the $i^{th}$ observation. This is the response variable that is trying to be predicted or explained, dependent on the corresponding explanatory variables $X_{i,1}, X_{i,2}, \ldots, X_{i,p}$.

- $\beta_0$: The intercept of the regression line. It represents the expected value of $Y_i$ when all the independent variables ($X$) are equal to 0.

- $\beta_1, \beta_2, \ldots, \beta_p$: The coefficients of the model. Each $\beta_j$ (for $j = 1, \ldots, p$) represents the expected change in $Y_i$ for a one-unit change in the $j^{th}$ independent variable, $X_{i,j}$, holding all other variables constant.

- $X_{i,1}, X_{i,2}, \ldots, X_{i,p}$: The independent variables (also called predictors or explanatory variables) for the $i^{th}$ observation. These variables are used to predict the value of the dependent variable.

- $\varepsilon_i$: The error term for the $i^{th}$ observation. It represents the difference between the observed value of the dependent variable and the value predicted by the model. It's assumed to be randomly distributed with a mean of 0.

- $i = 1, \ldots, n$: This indicates that the equation applies to each observation in the dataset, from the first ($i = 1$) to the $n^{th}$ (the last observation), where $n$ is the total number of observations.

## Model set-up
$$
\begin{split}
\text{pts}_i =\ &\beta_0 + \beta_1 \times \text{average\_home\_matchday\_attendance}_i \\
&+ \beta_2 \times \text{total\_wage\_bill}_i + \beta_3 \times \text{market\_value}_i + \varepsilon_i
\end{split}
\tag{2}
$$

Equation (2) can be explained as follows: 

- $\text{pts}_i$: The dependent variable for the $i^{th}$ observation. This is the outcome variable that the model is trying to predict or explain, which in this context could represent points (or any other metric of success) associated with each observation.

- $\beta_1, \beta_2, \beta_3$: The coefficients of the model. Each of these coefficients represents the expected change in $\text{pts}_i$ for a one-unit increase in their respective independent variable, assuming all other variables are held constant.
    - $\beta_1$ is associated with $\text{average\_home\_matchday\_attendance}_i$, indicating how changes in home matchday attendance are expected to affect $\text{pts}_i$.
    - $\beta_2$ corresponds to $\text{total\_wage\_bill}_i$, reflecting the impact of the total wage bill on $\text{pts}_i$.
    - $\beta_3$ is linked with $\text{market\_value}_i$, showing how the market value is predicted to influence $\text{pts}_i$.

## Model justification

The linear regression model given by Equation (2), derived from the foundational principles of linear regression outlined in Equation (1), provides a transparent mechanism to quantify the impact of various factors on the total points accumulated by EPL teams (a direct correlation to team rank in league standings). The model will aid in gaining insights into how attendance, total payroll, and market value could affect performance metrics. The model is operationalized using the `lm` function in `R`.

# Results

# Discussion

## First discussion point {#sec-first-point}

## Second discussion point

## Third discussion point

## Weaknesses and next steps

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

## Diagnostics

\newpage


# References


